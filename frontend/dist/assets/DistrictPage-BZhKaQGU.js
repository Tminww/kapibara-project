import{u as le,h as w,a as f,c as k,o as g,_ as O,G as U,H as oe,i as ee,w as s,e as o,f as B,m as q,k as T,t as L,l as c,I as te,x as A,g as I,D as ne,r as y,E as G,F as X,y as re,K as ie}from"./index-Dlkkv6Iw.js";import{g as ae,d as se,c as j,h as W}from"./utils-DAVKSodD.js";import{V as K}from"./VDateInput-DTHU6aHi.js";import{_ as de}from"./TIcon-Cx-csgO5.js";import{a as Q}from"./index-DHjOUhyH.js";const Z={__name:"TDonutChart",props:{labels:{type:Array,required:!0},series:{type:Array,required:!0},height:{type:Number,required:!1},legendPosition:{type:String,default:"left",validators:["top","bottom","left","right"]},isLegendClickable:{type:Boolean,default:!1},routeName:{type:String,default:"region"}},setup(m){const e=m,h=le(),l={"Центральный ФО":1,"Северо-Западный ФО":2,"Южный ФО":3,"Приволжский ФО":4,"Уральский ФО":5,"Сибирский ФО":6,"Дальневосточный ФО":7,"Северо-Кавказский ФО":8},u=r=>l[r],p=w(()=>({series:e.series,chartOptions:{chart:{animations:{enabled:!1,speed:1e3,animateGradually:{enabled:!0,delay:1e3},dynamicAnimation:{enabled:!0,speed:1e3}},background:"#fff",id:"Колличество_нормативных_правовых_актов_в_каждом_округе",type:"donut",toolbar:{show:!1,offsetX:0,offsetY:0,tools:{download:!0,selection:!1,zoom:!0,zoomin:!0,zoomout:!0,pan:!0},customIcons:[],autoSelected:"zoom"},events:{legendClick:(r,t,a)=>{const v=a.globals.labels[t];e.isLegendClickable&&h.push({name:e.routeName,params:{id:u(v)},query:{label:v}})}}},plotOptions:{pie:{donut:{size:"65%",background:"transparent",labels:{show:!0,name:{show:!0,fontSize:"10px",fontWeight:600,color:"#000",offsetY:0,formatter:function(r){return r}},value:{show:!0,fontSize:"16px",fontWeight:400,color:void 0,offsetY:16,formatter:function(r){function t(a){return a.toString().replace(new RegExp("\\B(?<!\\.\\d*)(?=(\\d{3})+(?!\\d))","g"),".")}return t(r)}},total:{show:!0,showAlways:!1,label:"ВСЕГО",fontSize:"14px",fontWeight:600,color:"#373d3f",formatter:function(r){function t(a){return a.toString().replace(new RegExp("\\B(?<!\\.\\d*)(?=(\\d{3})+(?!\\d))","g"),".")}return t(r.globals.seriesTotals.reduce((a,v)=>a+v,0))}}}}}},labels:e.labels,dataLabels:{enabled:!0,enabledOnSeries:void 0,textAnchor:"middle",distributed:!1,offsetX:0,offsetY:0,style:{fontSize:"12px",fontFamily:"Helvetica, Arial, sans-serif",fontWeight:"bold",colors:["#000"]},background:{enabled:!1,foreColor:"#fff",padding:4,borderRadius:2,borderWidth:1,borderColor:"#fff",opacity:.9,dropShadow:{enabled:!1,top:1,left:1,blur:1,color:"#000",opacity:.45}},dropShadow:{enabled:!1,top:1,left:1,blur:1,color:"#fff",opacity:1}},legend:{show:!0,showForSingleSeries:!1,showForNullSeries:!0,showForZeroSeries:!0,position:e.legendPosition,horizontalAlign:"center",floating:!1,fontSize:"14px",fontWeight:400,formatter:(r,t)=>{function a(v){return v.toString().replace(new RegExp("\\B(?<!\\.\\d*)(?=(\\d{3})+(?!\\d))","g"),".")}return`${r}: ${a(t.w.globals.series[t.seriesIndex])}`},inverseOrder:!1,tooltipHoverFormatter:void 0,customLegendItems:[],clusterGroupedSeries:!0,clusterGroupedSeriesOrientation:"vertical",offsetX:0,offsetY:0,itemMargin:{horizontal:7,vertical:5},height:80,width:"auto",labels:{hideOverlappingLabels:!1,trim:!1}},noData:{text:"Нет данных",style:{color:void 0,fontSize:"20px",fontFamily:"Nunito"}},fill:{type:"pattern",opacity:1,pattern:{enabled:!0,style:[]}},states:{hover:{filter:"none"}},theme:{palette:"palette7",monochrome:{enabled:!0,color:"#2196F3",shadeTo:"light",shadeIntensity:.65}},title:{text:""},tooltip:{enabled:!1,hideEmptySeries:!0,fillSeriesColor:!1,theme:!1,style:{fontSize:"12px",fontFamily:void 0},onDatasetHover:{highlightDataSeries:!1},x:{show:!0,format:"dd MMM",formatter:void 0},y:{formatter:void 0,title:{formatter:r=>r}},z:{formatter:void 0,title:"Size: "},marker:{show:!0},fixed:{enabled:!0,position:"topRight",offsetX:0,offsetY:0}}}}));return(r,t)=>{const a=f("apexchart");return g(),k(a,{options:p.value.chartOptions,series:p.value.series,height:e.height},null,8,["options","series","height"])}}},ue={key:0},ce={key:1,class:"text-caption align-self-center"},me={class:"group-date"},fe={class:"group-botton"},pe={__name:"TFilterForm",props:{items:{type:Array,required:!0},loading:{type:Boolean,default:!1}},emits:["submit"],setup(m,{emit:e}){const h=m,l=U({selectedItems:[],selectedPeriod:"За прошлый месяц",startDate:null,endDate:null}),u=U({selectedItems:[],selectedPeriod:"",startDate:null,endDate:null});oe(()=>{u.selectedItems=[...l.selectedItems],u.selectedPeriod=l.selectedPeriod,u.startDate=l.startDate,u.endDate=l.endDate});const p=t=>{let a;switch(t){case"За прошлый месяц":a=j();break;case"За прошлый квартал":a=se();break;case"За прошлый год":a=ae();break;default:a={startDate:null,endDate:null}}l.startDate=new Date(a.startDate),l.endDate=new Date(a.endDate)},r=()=>{l.selectedItems=h.items.map(t=>t.id),l.selectedPeriod="За прошлый месяц",p(l.selectedPeriod)};return ee(()=>{l.selectedItems=h.items.map(t=>t.id),l.selectedPeriod="За прошлый месяц",p(l.selectedPeriod)}),(t,a)=>{const v=f("v-select"),x=f("v-divider"),Y=f("v-btn"),M=f("v-form");return g(),k(M,{class:"form-container",onSubmit:a[4]||(a[4]=te(_=>t.$emit("submit",u),["prevent"]))},{default:s(()=>[o(v,{class:"mb-3",color:"primary",density:"comfortable",clearable:"",multiple:"","hide-details":"",variant:"outlined",label:t.district.name,"item-title":"name","item-value":"id",items:t.getSubjectItemsAndId(t.district),"model-value":l.selectedSubjects[t.district.id]||[],"onUpdate:modelValue":a[0]||(a[0]=_=>l.selectedSubjects[t.district.id]=_)},{selection:s(({item:_,index:V})=>[V<1?(g(),q("div",ue,[B("span",null,L(_.title),1)])):T("",!0),V===1?(g(),q("span",ce," (+"+L((l.selectedSubjects[t.district.id]||[]).length-1)+" другие) ",1)):T("",!0)]),_:1},8,["label","items","model-value"]),o(x,{class:"my-4"}),o(v,{density:"comfortable",variant:"outlined",label:"Выбрать период",modelValue:l.selectedPeriod,"onUpdate:modelValue":[a[1]||(a[1]=_=>l.selectedPeriod=_),p],items:["За прошлый месяц","За прошлый квартал","За прошлый год"]},null,8,["modelValue"]),B("div",me,[o(c(K),{label:"Дата начала",placeholder:"DD.MM.YYYY","prepend-icon":"",variant:"outlined",modelValue:l.startDate,"onUpdate:modelValue":a[2]||(a[2]=_=>l.startDate=_)},null,8,["modelValue"]),o(c(K),{label:"Дата окончания",placeholder:"DD.MM.YYYY","prepend-icon":"",variant:"outlined",modelValue:l.endDate,"onUpdate:modelValue":a[3]||(a[3]=_=>l.endDate=_)},null,8,["modelValue"])]),B("div",fe,[o(Y,{class:"items",type:"submit",loading:h.loading,color:"primary",variant:"tonal",text:"Применить"},null,8,["loading"]),o(Y,{class:"items",text:"Отменить",color:"red",variant:"tonal",onClick:r})])]),_:1})}}},ve=O(pe,[["__scopeId","data-v-ffca18a6"]]),ge={class:"sidebar-wrapper"},he={__name:"TFilterSidebar",props:{modelValue:{type:Boolean,required:!0},loading:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(m,{emit:e}){const h=m,l=e,u=w({get:()=>h.modelValue,set:r=>l("update:modelValue",r)}),p=()=>{u.value=!u.value};return(r,t)=>{const a=f("v-list-item-title"),v=f("v-btn"),x=f("v-list-item"),Y=f("v-progress-circular"),M=f("v-container"),_=f("v-navigation-drawer");return g(),q("div",ge,[o(_,{location:"left",temporary:"",floating:"",width:350,modelValue:u.value,"onUpdate:modelValue":t[0]||(t[0]=V=>u.value=V),scrim:!0},{default:s(()=>[o(x,{nav:""},{append:s(()=>[o(v,{icon:"mdi-chevron-left",variant:"text",onClick:te(p,["stop"])})]),default:s(()=>[o(a,null,{default:s(()=>t[1]||(t[1]=[B("h2",{class:"font-weight-bold pl-2"},"Настроить фильтры",-1)])),_:1})]),_:1}),o(M,{class:"scrollable-container pt-0"},{default:s(()=>[m.loading?(g(),k(Y,{key:0,class:"d-flex align-center justify-center",indeterminate:""})):A(r.$slots,"form",{key:1},void 0,!0)]),_:3})]),_:3},8,["modelValue"])])}}},_e=O(he,[["__scopeId","data-v-3335b900"]]),be={key:0,class:"loader-wrap"},ye={key:1,class:"chart-wrap"},De={class:"text-h7 time-wrap"},Se={__name:"TRegionCard",props:{title:{type:String,required:!1,default:"Область"},subtitle:{type:String,required:!1},width:{type:Number,required:!1},maxHeight:{type:Number,required:!1},height:{type:Number,required:!1},maxWidth:{type:Number,required:!1},minWidth:{type:Number,required:!1},isLoading:{type:Boolean,required:!0,default:!0}},setup(m){return(e,h)=>{const l=f("v-card-title"),u=f("v-card-subtitle"),p=f("v-card-text"),r=f("v-card-actions"),t=f("v-card");return g(),k(t,{loading:m.isLoading,"max-width":m.maxWidth,"min-width":m.minWidth,"max-height":m.maxHeight,width:m.width,height:m.height,elevation:"3",class:"card-container full-width-card"},{default:s(()=>[o(l,{class:"title-wrap mt-2"},{default:s(()=>[I(L(m.title),1)]),_:1}),m.subtitle?(g(),k(u,{key:0,class:"subtitle-wrap"},{default:s(()=>[I(L(m.subtitle),1)]),_:1})):T("",!0),o(p,{class:"pb-0 pt-0"},{default:s(()=>[m.isLoading?(g(),q("div",be,[o(c(de),{name:"dashboard-gray",width:310,height:350})])):(g(),q("div",ye,[A(e.$slots,"chart",{},void 0,!0)]))]),_:3}),o(r,{class:"justify-space-between"},{default:s(()=>[A(e.$slots,"previous",{},void 0,!0),B("div",De,[A(e.$slots,"interval",{},void 0,!0)]),A(e.$slots,"next",{},void 0,!0)]),_:3})]),_:3},8,["loading","max-width","min-width","max-height","width","height"])}}},J=O(Se,[["__scopeId","data-v-0531b657"]]),we=ne("district",()=>{const m=y(!1),e=y("За прошлый месяц"),h=y([]),l=y(""),u=y(""),p=y([]),r=y([]),t=y([]),a=w(()=>l.value),v=w(()=>u.value),x=w(()=>m.value),Y=w(()=>p.value||[]),M=w(()=>r.value||[]),_=w(()=>r.value.stat||[]),V=w(()=>t.value),R=w(()=>r.value.name||"Общая статистика"),E=()=>{t.value=[]},n=async()=>{m.value=!0},i=async()=>{m.value=!1},b=d=>{p.value=Array.isArray(d)?d:[]},D=()=>{p.value=[],r.value=[]},P=()=>{h.value=t.value.map(d=>d.id),e.value="За прошлый месяц",C(e.value)},C=d=>{let S;switch(d){case"За прошлый месяц":S=j();break;case"За прошлый квартал":S=se();break;case"За прошлый год":S=ae();break;default:S={startDate:null,endDate:null}}l.value=S.startDate,u.value=S.endDate};return{loading:m,districtsToRequest:t,startDate:l,endDate:u,selectedItems:h,selectedPeriod:e,getStartDate:a,getEndDate:v,isLoading:x,getDistrictsToRequest:V,getStatistics:Y,getAllStatistics:M,getAllStat:_,getDistrictName:R,startLoading:n,endLoading:i,setStatistics:b,dropStatistics:D,loadDistrictsToRequest:async()=>{try{const d=await Q.subjects.read();t.value=d.data}catch(d){console.error("Ошибка при загрузке субъектов:",d),E()}},loadStatistics:async d=>{var S,N;try{const $=await Q.statistics.readDistricts(d);p.value=((S=$.data)==null?void 0:S.districts)||[],r.value=((N=$.data)==null?void 0:N.stat)||[],l.value=$.startDate,u.value=$.endDate}catch($){throw console.error("Ошибка при загрузке статистики:",$),D(),$}},initializeForm:P,updateDatesByPeriod:C,resetForm:()=>{l.value=null,u.value=null,h.value=t.value.map(d=>d.id),e.value="За прошлый месяц",C(e.value)}}}),Ve={__name:"DistrictPage",setup(m){const e=we(),h=y(!1),l=y(!1),u=y(!1),p=y(!1),r=y(null),t=y(!1),a=y(null),v=w(()=>e.isLoading||t.value),x=()=>{const n={startDate:e.startDate,endDate:e.endDate};return e.selectedItems.length>0&&(n.ids=e.selectedItems.toString()),n},Y=async()=>{try{l.value=!0,t.value=!0,a.value=null;const n=new Date(e.startDate),i=j(n);e.startDate=i.startDate,e.endDate=i.endDate;const b=x();await e.loadStatistics(b)}catch(n){a.value=n.message,e.dropStatistics()}finally{l.value=!1,t.value=!1}},M=async()=>{try{const n=new Date(e.startDate);if(n.setMonth(n.getMonth()+1),n>new Date){ie.warning("Нельзя переходить в будущее");return}n.setMonth(n.getMonth()+1),u.value=!0,t.value=!0,a.value=null;const i=j(n);e.startDate=i.startDate,e.endDate=i.endDate;const b=x();await e.loadStatistics(b)}catch(n){a.value=n.message,e.dropStatistics()}finally{u.value=!1,t.value=!1}},_=n=>{const i=n.getFullYear(),b=String(n.getMonth()+1).padStart(2,"0"),D=String(n.getDate()).padStart(2,"0");return`${i}-${b}-${D}`},V=(n,i,b)=>{const D={};return i&&(D.startDate=i),b&&(D.endDate=b),n.length>0&&(D.ids=n.toString()),D},R=async n=>{try{await e.startLoading(),e.selectedItems=[...n.selectedItems],e.selectedPeriod=n.selectedPeriod,e.startDate=_(n.startDate),e.endDate=_(n.endDate);const i=V(e.selectedItems,e.startDate,e.endDate);await e.loadStatistics(i)}catch{e.dropStatistics()}finally{await e.endLoading()}},E=async()=>{try{p.value=!0,r.value=null,await e.loadDistrictsToRequest(),t.value=!0,a.value=null,e.initializeForm();const n=x();await e.loadStatistics(n)}catch(n){r.value=n.message,a.value=n.message,e.dropStatistics()}finally{p.value=!1,t.value=!1}};return ee(async()=>{await E()}),(n,i)=>{const b=f("v-btn"),D=f("v-container"),P=f("v-col"),C=f("v-row"),H=f("v-alert"),z=f("v-icon");return g(),q(X,null,[o(c(_e),{modelValue:h.value,"onUpdate:modelValue":i[1]||(i[1]=F=>h.value=F),loading:p.value},{form:s(()=>[o(c(ve),{loading:c(e).isLoading,items:c(e).getDistrictsToRequest,onSubmit:i[0]||(i[0]=F=>R(F))},null,8,["loading","items"])]),_:1},8,["modelValue","loading"]),o(C,{"no-gutters":"",class:"justify-start"},{default:s(()=>[o(P,null,{default:s(()=>[o(D,{fluid:"",class:"my-0 py-0"},{default:s(()=>[o(b,{color:"primary",variant:"tonal",onClick:i[2]||(i[2]=F=>h.value=!h.value)},{default:s(()=>i[3]||(i[3]=[I(" Фильтры ")])),_:1})]),_:1})]),_:1})]),_:1}),a.value||r.value?(g(),k(C,{key:0},{default:s(()=>[o(P,null,{default:s(()=>[o(D,{fluid:""},{default:s(()=>[r.value?(g(),k(H,{key:0,class:"d-flex align-center justify-center",type:"error",title:"Произошла ошибка",text:a.value||r.value,variant:"tonal"},null,8,["text"])):T("",!0)]),_:1})]),_:1})]),_:1})):(g(),k(C,{key:1,"no-gutters":"",class:"justify-space-around"},{default:s(()=>{var F;return[(F=c(e).getAllStat)!=null&&F.length?(g(),k(P,{key:0,cols:"auto"},{default:s(()=>[o(D,null,{default:s(()=>[o(c(J),{title:c(e).getDistrictName||"Общая статистика","is-loading":v.value,"min-width":400,"max-width":400},G({chart:s(()=>[o(c(Z),{labels:c(e).getAllStat.map(d=>d.name),series:c(e).getAllStat.map(d=>d.count),height:350,"enable-logarithmic":!1,"log-base":10,"y-start-value":0,"legend-position":"bottom"},null,8,["labels","series"])]),previous:s(()=>[o(b,{color:"primary",loading:l.value,onClick:Y},{default:s(()=>[o(z,null,{default:s(()=>i[4]||(i[4]=[I("mdi-arrow-left")])),_:1})]),_:1},8,["loading"])]),next:s(()=>[o(b,{color:"primary",loading:u.value,onClick:M},{default:s(()=>[o(z,null,{default:s(()=>i[5]||(i[5]=[I("mdi-arrow-right")])),_:1})]),_:1},8,["loading"])]),_:2},[v.value?void 0:{name:"interval",fn:s(()=>[I(L(c(W)(c(e).getStartDate,"DD.MM.YYYY"))+" - "+L(c(W)(c(e).getEndDate,"DD.MM.YYYY")),1)]),key:"0"}]),1032,["title","is-loading"])]),_:1})]),_:1})):T("",!0),(g(!0),q(X,null,re(c(e).getStatistics,d=>(g(),k(P,{cols:"auto",key:d.name},{default:s(()=>{var S;return[(S=d==null?void 0:d.stat)!=null&&S.length?(g(),k(D,{key:0},{default:s(()=>[o(c(J),{title:d.name||"Без названия","is-loading":v.value,"min-width":400,"max-width":400},G({chart:s(()=>[o(c(Z),{labels:d.stat.map(N=>N.name),series:d.stat.map(N=>N.count),height:350,"enable-logarithmic":!1,"log-base":10,"y-start-value":0,"legend-position":"bottom"},null,8,["labels","series"])]),previous:s(()=>[o(b,{color:"primary",loading:l.value,onClick:Y},{default:s(()=>[o(z,null,{default:s(()=>i[6]||(i[6]=[I("mdi-arrow-left")])),_:1})]),_:1},8,["loading"])]),next:s(()=>[o(b,{color:"primary",loading:u.value,onClick:M},{default:s(()=>[o(z,null,{default:s(()=>i[7]||(i[7]=[I("mdi-arrow-right")])),_:1})]),_:1},8,["loading"])]),_:2},[v.value?void 0:{name:"interval",fn:s(()=>[I(L(c(W)(c(e).getStartDate,"DD.MM.YYYY"))+" - "+L(c(W)(c(e).getEndDate,"DD.MM.YYYY")),1)]),key:"0"}]),1032,["title","is-loading"])]),_:2},1024)):T("",!0)]}),_:2},1024))),128))]}),_:1}))],64)}}};export{Ve as default};
