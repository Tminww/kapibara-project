import{d as oe,r as c,h as v,b as le,p as ne,i as se,c as p,w as e,a as n,f as i,e as t,g as l,k as w,t as s,l as re,C as S,m as z,u as ie,o as d,_ as de}from"./index-Dlkkv6Iw.js";import{a as ue}from"./index-DHjOUhyH.js";const ce={class:"d-flex justify-start mb-6"},_e={key:1,class:"text-grey"},me={style:{"max-width":"300px"}},ve={class:"d-flex flex-column"},pe={class:"font-weight-medium"},fe={key:0,class:"text-caption text-grey"},ye={class:"d-flex flex-column"},ge={key:0},be={class:"text-caption ml-1"},ke={key:1},xe={class:"text-caption ml-1"},we={key:1,class:"text-grey"},ze={class:"text-center py-8"},he={class:"d-flex justify-center pa-4"},De=oe({__name:"TablePage",setup(Ve){const f=le(),E=ie(),T=c([]),D=c(!1),q=c(0),y=c(1),N=c(1),R=c(10),G=c("date_of_publication"),I=c("desc"),h=c(!1),L=c(""),V=v(()=>f.query.type),P=v(()=>f.query.label),g=v(()=>f.query.name),b=v(()=>f.query.startDate),k=v(()=>f.query.endDate),O="http://publication.pravo.gov.ru/document/",A=[{title:"№ Документа",key:"eo_number",width:150},{title:"Название",key:"name",width:300},{title:"Тип",key:"type_name",width:200},{title:"Регион",key:"region_name",width:200},{title:"Даты",key:"dates",width:150,sortable:!1},{title:"Страниц",key:"pages_count",width:100},{title:"Действия",key:"actions",width:120,sortable:!1}];v(()=>[{title:"Главная",to:"/"},{title:"Графики",to:"/charts"},{title:"Детальная таблица",disabled:!0}]);const F={year:"По году",type:"По типу документа",district:"По федеральному округу",region:"По региону",nomenclature:"По номенклатуре",authority:"По органу власти","district-type":"Тип документа в ФО","region-type":"Тип документа в регионе","districts-type-all":"Тип документа во всех регионах"},H=v(()=>F[V.value]||"Фильтр"),U=v(()=>b.value&&k.value?`${b.value} - ${k.value}`:null),$=u=>u?new Date(u).toLocaleDateString("ru-RU"):"",C=async()=>{D.value=!0;try{const u={type:V.value,label:P.value,page:y.value,page_size:R.value,sort_by:G.value,sort_order:I.value};g.value&&(u.name=g.value),b.value&&(u.startDate=b.value),k.value&&(u.endDate=k.value);const _=(await ue.table.getDocuments(u)).data;T.value=_.documents,q.value=_.total_count,N.value=_.total_pages}catch(u){console.error("Ошибка загрузки документов:",u),L.value="Ошибка при загрузке данных. Попробуйте позже.",h.value=!0}finally{D.value=!1}},J=()=>{E.go(-1)};return ne([V,P,g,b,k],()=>{y.value=1,C()}),se(()=>{C()}),(u,a)=>{const _=n("v-btn"),r=n("v-icon"),K=n("v-card-title"),m=n("v-chip"),x=n("v-col"),Q=n("v-row"),W=n("v-card-text"),j=n("v-card"),M=n("v-tooltip"),X=n("v-skeleton-loader"),Y=n("v-data-table"),Z=n("v-divider"),ee=n("v-pagination"),te=n("v-snackbar"),ae=n("v-container");return d(),p(ae,null,{default:e(()=>[i("div",ce,[t(_,{"prepend-icon":"mdi-arrow-left",color:"primary",variant:"outlined",size:"large",onClick:J},{default:e(()=>a[3]||(a[3]=[l(" Назад к графикам ")])),_:1})]),t(j,{class:"mb-6",elevation:"2"},{default:e(()=>[t(K,{class:"bg-primary text-white"},{default:e(()=>[t(r,{icon:"mdi-table",class:"me-2"}),a[4]||(a[4]=l(" Детальная таблица документов "))]),_:1}),t(W,{class:"pa-4"},{default:e(()=>[t(Q,null,{default:e(()=>[t(x,{cols:"12",md:"3"},{default:e(()=>[t(m,{color:"primary",variant:"outlined",size:"large"},{default:e(()=>[t(r,{icon:"mdi-filter",start:""}),l(" "+s(H.value),1)]),_:1})]),_:1}),t(x,{cols:"12",md:"3"},{default:e(()=>[t(m,{color:"secondary",variant:"outlined",size:"large"},{default:e(()=>[t(r,{icon:"mdi-magnify",start:""}),l(" "+s(P.value),1)]),_:1})]),_:1}),g.value?(d(),p(x,{key:0,cols:"12",md:"3"},{default:e(()=>[t(m,{color:"accent",variant:"outlined",size:"large"},{default:e(()=>[t(r,{icon:"mdi-map-marker",start:""}),l(" "+s(g.value),1)]),_:1})]),_:1})):w("",!0),U.value?(d(),p(x,{key:1,cols:"12",md:"3"},{default:e(()=>[t(m,{color:"warning",variant:"outlined",size:"large"},{default:e(()=>[t(r,{icon:"mdi-calendar-range",start:""}),l(" "+s(U.value),1)]),_:1})]),_:1})):w("",!0),t(x,{cols:"12",md:"3",class:"mt-2"},{default:e(()=>[t(m,{color:"info",size:"large"},{default:e(()=>[t(r,{icon:"mdi-file-document-multiple",start:""}),l(" Всего: "+s(q.value)+" документов ",1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(j,null,{default:e(()=>[t(Y,{headers:A,items:T.value,loading:D.value,"items-per-page":R.value,page:y.value,"hide-default-footer":"",class:"elevation-1"},{"item.eo_number":e(({item:o})=>[o.eo_number?(d(),p(m,{key:0,color:"primary",variant:"outlined",size:"small"},{default:e(()=>[l(s(o.eo_number),1)]),_:2},1024)):(d(),z("span",_e,"—"))]),"item.name":e(({item:o})=>[i("div",me,[t(M,{text:o.name||o.title},{activator:e(({props:B})=>[i("span",S(B,{class:"text-truncate d-block"}),s(o.name||o.title||"—"),17)]),_:2},1032,["text"])])]),"item.type_name":e(({item:o})=>[t(m,{color:"secondary",variant:"tonal",size:"small"},{default:e(()=>[l(s(o.type_name||"—"),1)]),_:2},1024)]),"item.region_name":e(({item:o})=>[i("div",ve,[i("span",pe,s(o.region_name||"—"),1),o.district_name?(d(),z("span",fe,s(o.district_name),1)):w("",!0)])]),"item.dates":e(({item:o})=>[i("div",ye,[o.date_of_publication?(d(),z("div",ge,[t(r,{size:"small",color:"success"},{default:e(()=>a[5]||(a[5]=[l("mdi-calendar-check")])),_:1}),i("span",be,s($(o.date_of_publication)),1)])):w("",!0),o.date_of_signing?(d(),z("div",ke,[t(r,{size:"small",color:"info"},{default:e(()=>a[6]||(a[6]=[l("mdi-pen")])),_:1}),i("span",xe,s($(o.date_of_signing)),1)])):w("",!0)])]),"item.pages_count":e(({item:o})=>[o.pages_count?(d(),p(m,{key:0,color:"info",variant:"outlined",size:"small"},{default:e(()=>[t(r,{start:"",size:"small"},{default:e(()=>a[7]||(a[7]=[l("mdi-file-document")])),_:1}),l(" "+s(o.pages_count),1)]),_:2},1024)):(d(),z("span",we,"—"))]),"item.actions":e(({item:o})=>[o.eo_number?(d(),p(_,{key:0,color:"primary",variant:"tonal",size:"small",href:re(O)+o.eo_number,target:"_blank",class:"text-none"},{default:e(()=>[t(r,{start:"",size:"small"},{default:e(()=>a[8]||(a[8]=[l("mdi-open-in-new")])),_:1}),a[9]||(a[9]=l(" Открыть "))]),_:2},1032,["href"])):(d(),p(M,{key:1,text:"Номер документа отсутствует"},{activator:e(({props:B})=>[t(_,S(B,{color:"grey",variant:"tonal",size:"small",disabled:"",class:"text-none"}),{default:e(()=>[t(r,{start:"",size:"small"},{default:e(()=>a[10]||(a[10]=[l("mdi-open-in-new")])),_:1}),a[11]||(a[11]=l(" Открыть "))]),_:2},1040)]),_:1}))]),loading:e(()=>[t(X,{type:"table-row@5"})]),"no-data":e(()=>[i("div",ze,[t(r,{size:"64",color:"grey-lighten-2"},{default:e(()=>a[12]||(a[12]=[l("mdi-file-document-remove")])),_:1}),a[13]||(a[13]=i("div",{class:"text-h6 text-grey mt-4"},"Документы не найдены",-1)),a[14]||(a[14]=i("div",{class:"text-body-2 text-grey"},"Попробуйте изменить параметры фильтрации",-1))])]),_:1},8,["items","loading","items-per-page","page"]),t(Z),i("div",he,[t(ee,{modelValue:y.value,"onUpdate:modelValue":[a[0]||(a[0]=o=>y.value=o),C],length:N.value,"total-visible":7},null,8,["modelValue","length"])])]),_:1}),t(te,{modelValue:h.value,"onUpdate:modelValue":a[2]||(a[2]=o=>h.value=o),color:"error",timeout:"5000",location:"top right"},{actions:e(()=>[t(_,{variant:"text",onClick:a[1]||(a[1]=o=>h.value=!1)},{default:e(()=>a[15]||(a[15]=[l(" Закрыть ")])),_:1})]),default:e(()=>[l(s(L.value)+" ",1)]),_:1},8,["modelValue"])]),_:1})}}}),Be=de(De,[["__scopeId","data-v-27b1435c"]]);export{Be as default};
